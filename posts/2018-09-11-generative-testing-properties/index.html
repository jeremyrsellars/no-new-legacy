<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<!-- 2018-09-11 Generative Testing Properties.md 2018-09-11 -->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta charset="utf-8">
  <title>Generative Testing Part 2 – Properties and Oracles - No New Legacy Code Blog - Jeremy Sellars</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, max-scale=1.0">
    <meta name="keywords" content="No New Legacy Code, #&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;,#&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;,#&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;,#&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;, #&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;,#&lt;Ruhoh::Views::MasterView:0x000000063ea278&gt;,">
    <meta name="description" content="&#39;Properties&#39; are the facts checked by generative testing.  We assert that some properties are true of our programs, and the testing library checks it for us.">
    <meta name="date" content="2018-09-11">
    <meta name="datePublished" content="2018-09-11">
    <meta name="revised" content="2018-11-11">
    <meta name="author" content="Jeremy Sellars">
    <meta name="geo.region" content="US-MO" />

<link href='/no-new-legacy/assets/stylesheets/bootstrap.min-82f77a9ca975e3765ed90050b04df670.css' type='text/css' rel='stylesheet' media='all'>
<link href='/no-new-legacy/assets/stylesheets/style-21784202ff2dd459e98edeb0ab87bf58.css' type='text/css' rel='stylesheet' media='all'>
<link href='/no-new-legacy/assets/stylesheets/google_prettify/sons-of-obsidian-1fc7bbae7ece7f100c56fc75a0e333cc.css' type='text/css' rel='stylesheet' media='all'>
<link href='/no-new-legacy/assets/stylesheets/application-e3642abd8348ea2b5f7b414c30786006.css' type='text/css' rel='stylesheet' media='all'>
  <!-- http://www.favicon-generator.org/ -->
  <link rel="apple-touch-icon" sizes="57x57" href="/no-new-legacy/assets/media/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/no-new-legacy/assets/media/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/no-new-legacy/assets/media/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/no-new-legacy/assets/media/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/no-new-legacy/assets/media/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/no-new-legacy/assets/media/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/no-new-legacy/assets/media/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/no-new-legacy/assets/media/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/no-new-legacy/assets/media/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/no-new-legacy/assets/media/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/no-new-legacy/assets/media/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/no-new-legacy/assets/media/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/no-new-legacy/assets/media/favicon-16x16.png">
  <link rel="manifest" href="/no-new-legacy/assets/media/manifest.json">
  <meta name="msapplication-TileColor" content="#753636">
  <meta name="msapplication-TileImage" content="/no-new-legacy/assets/media/ms-icon-144x144.png">
  <meta name="theme-color" content="#753636">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  <!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->

  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-85077174-2']);
  _gaq.push(['_trackPageview']);
  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>



</head>
<body itemscope="" itemtype="http://schema.org/WebPage">
<div id="header" tabindex="0" hidefocus="true">
  <div class="container">
    <div id="logo">
      <h1><a href="/no-new-legacy/">No New Legacy Code</a></h1>
    </div>
    <div id="menu">
      <ul class="nav">
          
            <li><a href="/no-new-legacy/archive">Archive</a></li>
          
          
            <li><a href="/no-new-legacy/tags">Tags</a></li>
          
          
            <li><a href="/no-new-legacy/categories">Categories</a></li>
          
          
            <li><a href="/no-new-legacy/pages">Pages</a></li>
          
      </ul>
    </div>
  </div>
</div>

<div id="wrapper">
  <div id="page" class="container">
    <div id="content" itemprop="mainContentOfPage">
      
<div class="page-header">
  <div class="span12">
    <h1>Generative Testing Part 2 – Properties and Oracles </h1>
  </div>
</div>

<div class="post-full">
  <div class="span12">
    <div class="date">
      <span>2018-09-11</strong>
    </div>
    <div class="content">
      <p>From the plain English root verbs of &quot;generative testing&quot;, we can surmise there are at least two actions to explore: &#39;generate&#39; and &#39;test&#39;.  In a nut shell, the actions are</p>

<ol>
<li>Generate some random test cases</li>
<li>Check that the software works.</li>
</ol>

<p>For this post, let&#39;s start with the more familiar part: <u>testing</u>.</p>

<h3 id="toc_0">Testing</h3>

<p>If you&#39;ve been around programming for any length of time, it will come as no surprise that &#39;testing&#39; means checking that the program works as expected.  Most generative testing software is part of a testing framework that does a lot of things for you, like selecting which tests to run, executing the tests, reporting the results of the tests, perhaps including a reason for the failure, etc..  One of the intents of this post is to connect with concepts you may already be familiar with, like unit testing.  Many of the foundational concepts of generative testing can be applied in testing frameworks like nUnit and jUnit.</p>

<p>Let&#39;s start with a simple test about the contents of a string: does a string look like sheep bleat?  For our purposes, let&#39;s define sheep bleat as any string that starts with a <code>b</code> and is followed by at least 2 <code>a</code>s, making a string like &quot;baa&quot; or &quot;baaaaaaaaaaaaaaaaa&quot;.  Further, let&#39;s say that only <code>b</code> and <code>a</code>s are allowed in sheep bleat, so <code>baad</code> isn&#39;t valid bleat.  If you are familiar with the textual pattern language called Regular Expressions, <code>^baa+$</code> would match all valid sheep bleat as defined earlier.</p>

<p>So a function signature might look like <code>bool isSheepBleat(string s){return false;}</code> or <code>(defn sheep-bleat? [s] false)</code>.</p>

<style id='sheep-bleat' class='before-alternating-table'></style>

<table><thead>
<tr>
<th>Text</th>
<th>Sheep Bleat?</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>b</code></td>
<td>false</td>
<td>Too short</td>
</tr>
<tr>
<td><code>ba</code></td>
<td>false</td>
<td>Too short</td>
</tr>
<tr>
<td><code>baa</code></td>
<td>true</td>
<td>2+ <code>a</code>s</td>
</tr>
<tr>
<td><code>baaa</code></td>
<td>true</td>
<td>2+ <code>a</code>s</td>
</tr>
<tr>
<td><code>baaad</code></td>
<td>false</td>
<td>invalid <code>d</code></td>
</tr>
<tr>
<td><code>·baa</code></td>
<td>false</td>
<td>leading space</td>
</tr>
<tr>
<td><code>baa·</code></td>
<td>false</td>
<td>trailing space</td>
</tr>
</tbody></table>

<h4 id="toc_1">Parameterized Tests</h4>

<p>You can probably imagine these tests in your unit testing framework of choice.  Perhaps each of these tests would be represented as a function asserting the expected true/false value.  Some frameworks let you specify the test code once, and then the test data can be delivered as a parameter to the tests.  That increases the signal-to-noise ratio, and helps you keep your eye on the data rather than the redundant function execution code.  If you haven&#39;t yet taken the opportunity to try parameterized tests in your framework, I believe it would be well-worth your time.</p>

<p>The parameterized test might look like this, which executes an assertion function for each example:</p>

<pre><code class="clojure">(defn sheep-bleat? [s] false) ; obvious bug here!

(defn assert-sheep-bleat
  [text expected-answer reason]
  (is (= expected-answer
         (sheep-bleat? text))
    reason))

(def examples
 [[&quot;b&quot;         false    &quot;Too short&quot;]
  [&quot;ba&quot;        false    &quot;Too short&quot;]
  [&quot;baa&quot;       true     &quot;2+ &#39;a&#39; s&quot;]
  [&quot;baaa&quot;      true     &quot;2+ &#39;a&#39; s&quot;]
  [&quot;baaad&quot;     false    &quot;invalid &#39; d&#39;&quot;]
  [&quot; baa&quot;      false    &quot;leading space&quot;]
  [&quot;baa &quot;      false    &quot;trailing space&quot;]])

(deftest Testing_sheep-bleat?
  ; Run the test for each of the examples
  (doseq [[text expected-answer reason] examples]
     (assert-sheep-bleat text expected-answer reason)))
</code></pre>

<p>Here is C# with nUnit.</p>

<pre><code class="csharp">    [TestFixture]
    public class A_Parameterized_Test
    {
        [TestCaseSource(nameof(SheepishExamples))]
        public void SheepBleatDetection(SheepishTestCase testCase) =&gt;
            Assert.AreEqual(
                testCase.IsSheepBleat,
                Sheepish.IsSheepBleat(testCase.Text), testCase.Reason);

        static IEnumerable&lt;SheepishTestCase&gt; SheepishExamples =&gt;
            new[] {
                new SheepishTestCase(&quot;b&quot;,         false,    &quot;Too short&quot;),
                new SheepishTestCase(&quot;ba&quot;,        false,    &quot;Too short&quot;),
                new SheepishTestCase(&quot;baa&quot;,       true,     &quot;2+ &#39;a&#39; s&quot;),
                new SheepishTestCase(&quot;baaa&quot;,      true,     &quot;2+ &#39;a&#39; s&quot;),
                new SheepishTestCase(&quot;baaad&quot;,     false,    &quot;invalid &#39; d&#39;&quot;),
                new SheepishTestCase(&quot; baa&quot;,      false,    &quot;leading space&quot;),
                new SheepishTestCase(&quot;baa &quot; ,     false,    &quot;trailing space&quot;),
            };

        public class SheepishTestCase
        {
            public SheepishTestCase(string text, bool isSheepBleat, string reason)
            {
                Text = text;
                IsSheepBleat = isSheepBleat;
                Reason = reason;
            }
            public string Text;
            public bool IsSheepBleat;
            public string Reason;
            // nUnit requires a unique ToString() for a name.
            public override string ToString() =&gt; Text;
        }
    }
</code></pre>

<h4 id="toc_2">Parameterized Test (with an oracle)</h4>

<p>With unit tests, we may wish to come up with specific examples and test that against a known-correct answer, but with generative testing we don&#39;t have the opportunity to think through the correct answer (examples are generated randomly, after all).  We will want a way to compute the expected answer.  This is sometimes called an &quot;oracle&quot; (think the deity that heroes from mythology consult to answer a question).  For this contrived example, we have a ready-made oracle that would provide the correct answer for any string: the regular expression <code>^baa+$</code></p>

<pre><code class="clojure">;; Same examples, but with the answers no-longer known beforehand.

(defn assert-sheep-bleat
  [text reason]
     ; ^ Remove the correct answer; we have to compute it somehow.
  (is (= (some? (re-find #&quot;^baa+$&quot; text))  ; true when a match is found, false when nil is returned.
         (sheep-bleat? text))
    reason))

(def examples
 [[&quot;b&quot;         &quot;Too short&quot;]
  [&quot;ba&quot;        &quot;Too short&quot;]
  [&quot;baa&quot;       &quot;2+ &#39;a&#39; s&quot;]
  [&quot;baaa&quot;      &quot;2+ &#39;a&#39; s&quot;]
  [&quot;baaad&quot;     &quot;invalid &#39;d&#39;&quot;]
  [&quot; baa&quot;      &quot;leading space&quot;]
  [&quot;baa &quot;      &quot;trailing space&quot;]])

(deftest Testing_sheep-bleat?_with_oracle
  ; Run the test for each of the examples
  (doseq [[text reason] examples]
    (assert-sheep-bleat text reason)))
</code></pre>

<pre><code class="csharp">    [TestFixture]
    public class B_Parameterized_Test_With_Oracle
    {
        [TestCaseSource(nameof(SheepishExamples))]
        public void SheepBleatDetection(SheepishTestCase testCase) =&gt;
            Assert.AreEqual(
                Regex.IsMatch(testCase.Text, @&quot;^baa+$&quot;),
                Sheepish.IsSheepBleat(testCase.Text), testCase.Reason);

        static IEnumerable&lt;SheepishTestCase&gt; SheepishExamples =&gt;
            new[] {
                new SheepishTestCase(&quot;b&quot;,         &quot;Too short&quot;),
                new SheepishTestCase(&quot;ba&quot;,        &quot;Too short&quot;),
                new SheepishTestCase(&quot;baa&quot;,       &quot;2+ &#39;a&#39; s&quot;),
                new SheepishTestCase(&quot;baaa&quot;,      &quot;2+ &#39;a&#39; s&quot;),
                new SheepishTestCase(&quot;baaad&quot;,     &quot;invalid &#39; d&#39;&quot;),
                new SheepishTestCase(&quot; baa&quot;,      &quot;leading space&quot;),
                new SheepishTestCase(&quot;baa &quot; ,     &quot;trailing space&quot;),
            };

        public class SheepishTestCase
        {
            public SheepishTestCase(string text, string reason)
            {
                Text = text;
                Reason = reason;
            }
            public string Text;
            public string Reason;
            // nUnit requires a unique ToString() for a name.
            public override string ToString() =&gt; Text;
        }
    }
</code></pre>

<h4 id="toc_3">Parameterized Test (with properties, without an oracle)</h4>

<p>Let&#39;s imagine we don&#39;t have an oracle to give us the right answers, but we do know some things that should always be true.  We know sheepish always begins with <code>b</code>, for example, which is easy to test.  We know it needs at least 2 <code>a</code>s (and since it starts with <code>b</code>, the length must be at least 3).  Let&#39;s look at a few such examples from the Sheepish specification.</p>

<pre><code class="clojure">(defn sheep-bleat?
  [s]
  true) ; obvious bug here!

(defn assert-sheep-bleat
  [text reason]
  (testing (str `(&quot;sheep-bleat?&quot; ~text) &quot;: &quot; reason)
    (when (&lt; (count text) 3)
      (is (false? (sheep-bleat? text))
        &quot;Bleat is always at least 3 characters.&quot;))
    (when (sheep-bleat? text)
      (is (string/starts-with? text &quot;b&quot;)
        &quot;Bleat always starts with `b`&quot;)
      (is (string/ends-with? text &quot;aa&quot;)
        &quot;Bleat always ends with `aa`&quot;)
      (is (= #{\a \b} (into #{} text))
        &quot;Bleat only contains `a` and `b` characters&quot;))
    (when-not (= #{\a \b} (into #{} text))
      (is (false? (sheep-bleat? text))
        &quot;Bleat only contains `a` and `b` characters&quot;))))
</code></pre>

<p>These facts should hold true for any test case applied to the system being tested.  Some only apply in certain circumstances.</p>

<p><strong>Note:</strong> Since we didn&#39;t use an oracle, we may not have covered all the test cases.  In fact, the above tests won&#39;t fail for the function that always returns <code>false</code>!  The tests fail for the <code>(constantly true)</code> function, but not the <code>(constantly false)</code> function.</p>

<p>This is one reason I recommend starting with example-based unit tests before moving on generating additional test cases.  But, just because you supply specific examples and results, that doesn&#39;t mean you can&#39;t benefit from the property tests above in the parameterized tests.  The properties should hold true for the specific examples and the new, generated examples.</p>

<h4 id="toc_4">Why using an oracle may not be the best choice</h4>

<ul>
<li>In many cases if you already have an algorithm that can create the right answer for a test case, there wouldn&#39;t be a reason to write new code.</li>
<li>Often we don&#39;t start out with an algorithm known to work, but stakeholders have identified some things they expected to be true of the system (nicely packaged in a specification document, if we&#39;re lucky).</li>
<li>Sometimes a specification may be incomplete or not internally consistent.

<ul>
<li>A specification I was working with recently explicitly forbade the number 1, but 0, 2, 3, 4, etc. were fine.  The problem was that the number 1 could actually occur (because of a revision in a different part of the document), and then the behavior was undefined.</li>
</ul></li>
<li>Sometimes an algorithm believed to work doesn&#39;t actually behave the way it is believed to – the properties don&#39;t hold true in some corner cases.  Maybe the algorithm is right and the spec is wrong, or vice versa.  Either way, it is helpful to identify this, and the earlier, the better.</li>
<li>The oracle may be &quot;expensive&quot; (measured computationally, dollar-cost, network, or some other resource) to use the oracle.

<ul>
<li>Is it a legacy system running on virtual hardware in the cloud?</li>
<li>Is it a third-party payment system that will only tell you that the request was issued correctly by issuing the request?</li>
</ul></li>
</ul>

<h1 id="toc_5">Next time</h1>

<p>This will set us up nicely for when the examples are generated by the generative testing library/framework.  <a href="/no-new-legacy/posts/2018-11-11-generative-testing-simple-generators/" title="">In part 3</a>, we&#39;ll get into the fun part: generating test data.</p>

<h1 id="toc_6">Source code</h1>

<p>If you want to follow along, the source code is here:</p>

<ul>
<li>Clojure: <a href="https://github.com/jeremyrsellars/no-new-legacy/src/sheepish"  target="_blank" rel="noopener" class="external">github.com/jeremyrsellars/no-new-legacy/src/sheepish</a></li>
<li>C#: <a href="https://github.com/jeremyrsellars/no-new-legacy/src/Sheepish.net"  target="_blank" rel="noopener" class="external">github.com/jeremyrsellars/no-new-legacy/src/Sheepish.net</a></li>
</ul>

    </div>
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      <li>
        <a href="/no-new-legacy/categories#Programming-ref">Programming <span>8</span></a>
      </li>
      <li>
        <a href="/no-new-legacy/categories#Craft-ref">Craft <span>4</span></a>
      </li>
    </ul>
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      <li>
        <a href="/no-new-legacy/tags#testing-ref">testing <span>4</span></a>
      </li>
      <li>
        <a href="/no-new-legacy/tags#generative testing-ref">generative testing <span>4</span></a>
      </li>
      <li>
        <a href="/no-new-legacy/tags#clojure.spec-ref">clojure.spec <span>4</span></a>
      </li>
      <li>
        <a href="/no-new-legacy/tags#nUnit-ref">nUnit <span>3</span></a>
      </li>
    </ul>
    <hr>
    <div class="pagination">
      <ul>
          <li class="prev"><a href="/no-new-legacy/posts/2018-09-07-generative-testing-introduction" title="Generative Testing Part 1 – Introduction">&larr; Previous</a></li>

          <li><a href="/no-new-legacy/archive">Archive</a></li>

          <li class="next"><a href="/no-new-legacy/posts/2018-11-11-generative-testing-simple-generators" title="Generative Testing Part 3 – Simple Generators">Next &rarr;</a></li>
      </ul>
    </div>
    <hr>
    
  </div>
</div>


    </div>
  </div>
</div>

<div id="footer" itemscope="" itemtype="http://schema.org/LocalBusiness">
      <div class="footer">
        <p>&copy; <a href="https://github.com/jeremyrsellars" itemprop="copyrightHolder">Jeremy Sellars</a> <span itemprop="copyrightYear">2015 - 2018</span>
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.
          <br>Theme based on <a href="https://templated.co/fullstrength" rel="nofollow" target="_blank">FullStrength</a> template from <a href="http://templated.co" rel="nofollow" target="_blank">TEMPLATED</a>

        </p>
      </div>

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->

</body>
</html>
